copyright apache software foundation rights reserved software published terms apache software license version copy included distribution license txt file installer java ioexception java output stream outputstream output stream compresses bzip format file header chars stream todo update bzip author href mailto keiron aftexsw keiron liddle cbzip output stream outputstream output stream outputstream bzip constants mask upper mask xffffff setmask clearmask setmask greater icost lesser icost small thresh depth thresh unlucky improbable stack overflow sorting increase constant practice stack elems limit generous qsort stack size crc crc crc in use inuse seq to unseq seqtounseq unseq to seq unseqtoseq selector max selectors selector mtf selectormtf max selectors mtf freq mtffreq max alpha size current char currentchar run length runlength closed knuth increments work incerpi sedgewick number elems sort small typically incs block randomised blockrandomised range current block size number block size blocksize bs buff bsbuff bs live bslive block block size zptr original string sorting orig ptr origptr allowable block size allowableblocksize block block crc blockcrc combined crc combinedcrc output stream outputstream bs stream bsstream first attempt firstattempt ftab n in use ninuse n mtf nmtf quadrant szptr work done workdone sorting comparisons happen sorting randomise block work factor workfactor work limit worklimit zptr cbzip output stream outputstream output stream outputstream output ioexception output cbzip output stream outputstream output stream outputstream output block size blocksize ioexception bs set stream bssetstream output work factor workfactor out block size outblocksize block size blocksize out block size outblocksize out block size outblocksize out block size outblocksize out block size outblocksize block size blocksize out block size outblocksize allocate compress structures allocatecompressstructures initialize init block initblock hb make code lengths hbmakecodelengths len freq alpha size alphasize max len maxlen nodes heap entries entry heap nodes sentinel n nodes nnodes nodes heap entries entry heap nodes sentinel n heap nheap nodes heap entries entry heap nodes sentinel nodes heap entries entry heap nodes sentinel nodes heap entries entry heap nodes sentinel nodes heap entries entry heap nodes sentinel nodes heap entries entry heap nodes sentinel too long toolong heap max alpha size weights max alpha size parent max alpha size alpha size alphasize weights freq freq n nodes nnodes alpha size alphasize n heap nheap heap weights parent alpha size alphasize parent n heap nheap heap n heap nheap tmp n heap nheap tmp heap weights tmp weights heap heap heap heap tmp n heap nheap max alpha size panic n heap nheap heap heap heap n heap nheap n heap nheap tmp tmp heap n heap nheap n heap nheap weights heap weights heap weights tmp weights heap heap heap heap tmp heap heap heap n heap nheap n heap nheap tmp tmp heap n heap nheap n heap nheap weights heap weights heap weights tmp weights heap heap heap heap tmp n nodes nnodes parent n nodes nnodes parent n nodes nnodes weights weights weight calculate weight calculateweight weights n nodes nnodes weight parent n nodes nnodes n heap nheap heap n heap nheap n nodes nnodes tmp n heap nheap tmp heap weights tmp weights heap heap heap heap tmp n nodes nnodes max alpha size panic too long toolong alpha size alphasize parent parent len max len maxlen too long toolong too long toolong alpha size alphasize weights weights calculate weight calculateweight upper upper mask upper mask mask mask nnnn upper nnnn panic system println panic cerror close ioexception closed run length runlength write run writerun current char currentchar end block endblock end compression endcompression closed close bs stream bsstream close finalize throwable close flush ioexception flush bs stream bsstream flush modified oliver merkel param description parameter exception java ioexception description exception write ioexception current char currentchar current char currentchar run length runlength run length runlength write run writerun current char currentchar run length runlength write run writerun run length runlength current char currentchar current char currentchar run length runlength allocate compress structures allocatecompressstructures base block size block size blocksize block num overshoot bytes quadrant num overshoot bytes zptr ftab block quadrant zptr ftab total draw totaldraw num overshoot bytes num overshoot bytes compress out of memory compressoutofmemory total draw totaldraw place store mtf values calculates coding tables zptr array values fit overlay szptr start zptr hope reducing number cache misses induced multiple traversals mtf values calculating coding tables improve compression speed szptr zptr szptr bs finished with stream bsfinishedwithstream ioexception bs live bslive bs buff bsbuff write bit bs stream bsstream write ioexception bs buff bsbuff bs live bslive bs put int vs bsputintvs num bits numbits ioexception bs w bsw num bits numbits bs put uchar bsputuchar ioexception bs w bsw bs putint bsputint ioexception bs w bsw xff bs w bsw xff bs w bsw xff bs w bsw xff bs set stream bssetstream output stream outputstream bs stream bsstream bs live bslive bs buff bsbuff bs w bsw ioexception bs live bslive bs buff bsbuff write bit bs stream bsstream write ioexception bs buff bsbuff bs live bslive bs buff bsbuff bs live bslive bs live bslive do reversible transformation doreversibletransformation work limit worklimit work factor workfactor work done workdone block randomised blockrandomised first attempt firstattempt main sort mainsort work done workdone work limit worklimit first attempt firstattempt randomise block randomiseblock work limit worklimit work done workdone block randomised blockrandomised first attempt firstattempt main sort mainsort orig ptr origptr zptr orig ptr origptr orig ptr origptr panic end block endblock ioexception block crc blockcrc crc get final crc getfinalcrc combined crc combinedcrc combined crc combinedcrc combined crc combinedcrc combined crc combinedcrc block crc blockcrc sort block establish posn original string do reversible transformation doreversibletransformation block header chosen arbitrarily bit strong guarantee chance compressed datastream worst probability event block bits bits bits compressed file size blocks bit marker normal compression decompression rely statistical properties recover blocks damaged files bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar block crc place bs putint bsputint block crc blockcrc single bit indicating randomisation block randomised blockrandomised bs w bsw bs w bsw block contents proper move to front code and send movetofrontcodeandsend end compression endcompression ioexception magic bit number block sqrt repetition feel statistically comfortable call paranoid bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs put uchar bsputuchar bs putint bsputint combined crc combinedcrc bs finished with stream bsfinishedwithstream full gt u fullgtu block block block block block block block block block block block block block block quadrant quadrant block block quadrant quadrant block block quadrant quadrant block block quadrant quadrant work done workdone generate mtfvalues generatemtfvalues tmp tmp z pend zpend eob make maps makemaps eob n in use ninuse eob mtf freq mtffreq z pend zpend n in use ninuse unseq to seq unseqtoseq block zptr tmp tmp tmp tmp tmp tmp tmp z pend zpend z pend zpend z pend zpend z pend zpend szptr runa mtf freq mtffreq runa szptr runb mtf freq mtffreq runb z pend zpend z pend zpend z pend zpend z pend zpend szptr mtf freq mtffreq z pend zpend z pend zpend z pend zpend szptr runa mtf freq mtffreq runa szptr runb mtf freq mtffreq runb z pend zpend z pend zpend z pend zpend szptr eob mtf freq mtffreq eob n mtf nmtf hb assign codes hbassigncodes code length min len minlen max len maxlen alpha size alphasize vec vec min len minlen max len maxlen alpha size alphasize length code vec vec vec init block initblock block no blockno crc initialise crc initialisecrc in use inuse paranoia constant allowable block size allowableblocksize base block size block size blocksize initialize ioexception write magic bytes indicating file format huffmanised digit indicating block size blocksize bs put uchar bsputuchar bs put uchar bsputuchar block size blocksize combined crc combinedcrc main sort mainsort running order runningorder copy big done bigdone verbosity fprintf stderr sort initialise num overshoot bytes block block num overshoot bytes quadrant block block simple sort simplesort full sorting mechanism large constant overhead zptr first attempt firstattempt work done workdone work limit worklimit simple sort simplesort big done bigdone ftab block block ftab ftab ftab block block ftab zptr ftab block block ftab zptr ftab ftab loc small bucket calculate running order smallest largest big bucket running order runningorder running order runningorder ftab running order runningorder ftab running order runningorder ftab ftab running order runningorder running order runningorder running order runningorder main sorting loop process big buckets starting full running order runningorder complete big bucket quicksorting unsorted small buckets previous pointer scanning phases completed small buckets don sort ftab setmask setmask ftab clearmask ftab clearmask q sort qsort work done workdone work limit worklimit first attempt firstattempt ftab setmask big bucket record fact update quadrant descriptors remember update quadrants overshoot area test skips updating bucket processed updating bucket pointless big done bigdone bb start bbstart ftab clearmask bb size bbsize ftab clearmask bb start bbstart shifts bb size bbsize shifts shifts bb size bbsize update zptr bb start bbstart q val qval shifts quadrant update q val qval update num overshoot bytes quadrant update q val qval bb size bbsize shifts panic scan big bucket synthesise sorted order small buckets copy ftab clearmask ftab clearmask ftab clearmask block zptr big done bigdone zptr copy zptr zptr copy ftab setmask make maps makemaps n in use ninuse in use inuse seq to unseq seqtounseq n in use ninuse unseq to seq unseqtoseq n in use ninuse n in use ninuse med move to front code and send movetofrontcodeandsend ioexception bs put int vs bsputintvs orig ptr origptr generate mtfvalues generatemtfvalues send mtfvalues sendmtfvalues q sort qsort lo st lost hi st hist d st dst un lo unlo un hi unhi lt lo ltlo gt hi gthi med stack elem stackelem stack stack elem stackelem qsort stack size count count qsort stack size count stack count stack elem stackelem stack lo st lost stack hi st hist stack d st dst qsort stack size panic stack stack stack small thresh depth thresh simple sort simplesort work done workdone work limit worklimit first attempt firstattempt med med block zptr block zptr block zptr un lo unlo lt lo ltlo un hi unhi gt hi gthi un lo unlo un hi unhi block zptr un lo unlo med temp temp zptr un lo unlo zptr un lo unlo zptr lt lo ltlo zptr lt lo ltlo temp lt lo ltlo un lo unlo un lo unlo un lo unlo un hi unhi block zptr un hi unhi med temp temp zptr un hi unhi zptr un hi unhi zptr gt hi gthi zptr gt hi gthi temp gt hi gthi un hi unhi un hi unhi un lo unlo un hi unhi temp temp zptr un lo unlo zptr un lo unlo zptr un hi unhi zptr un hi unhi temp un lo unlo un hi unhi gt hi gthi lt lo ltlo stack stack stack lt lo ltlo un lo unlo lt lo ltlo lt lo ltlo un lo unlo lt lo ltlo vswap un lo unlo gt hi gthi gt hi gthi un hi unhi gt hi gthi gt hi gthi un hi unhi vswap un lo unlo un lo unlo lt lo ltlo gt hi gthi un hi unhi stack stack stack stack stack stack stack stack stack randomise block randomiseblock r nto go rntogo r tpos rtpos in use inuse r nto go rntogo r nto go rntogo rand nums r tpos rtpos r tpos rtpos r tpos rtpos r tpos rtpos r nto go rntogo block r nto go rntogo handle bit signed numbers block x ff xff in use inuse block send mtfvalues sendmtfvalues ioexception len groups max alpha size iter n selectors nselectors alpha size alphasize min len minlen max len maxlen sel ctr selctr n groups ngroups alpha size alphasize n in use ninuse groups alpha size alphasize len greater icost decide coding tables n mtf nmtf panic n mtf nmtf n groups ngroups n mtf nmtf n groups ngroups n mtf nmtf n groups ngroups n mtf nmtf n groups ngroups n groups ngroups generate initial set coding tables n part npart rem f remf t freq tfreq a freq afreq n part npart n groups ngroups rem f remf n mtf nmtf n part npart t freq tfreq rem f remf n part npart a freq afreq a freq afreq t freq tfreq alpha size alphasize a freq afreq mtf freq mtffreq n part npart n groups ngroups n part npart n groups ngroups n part npart a freq afreq mtf freq mtffreq alpha size alphasize len n part npart lesser icost len n part npart greater icost n part npart rem f remf a freq afreq rfreq groups max alpha size fave groups cost groups iterate iters times improve tables iter iter iters iter n groups ngroups fave n groups ngroups alpha size alphasize rfreq n selectors nselectors set group start marks n mtf nmtf size n mtf nmtf n mtf nmtf calculate cost group coded coding tables n groups ngroups cost n groups ngroups cost cost cost cost cost cost icv szptr cost len icv cost len icv cost len icv cost len icv cost len icv cost len icv cost cost cost cost cost cost cost cost cost cost cost cost icv szptr n groups ngroups cost len icv find coding table group record identity selector table n groups ngroups cost cost fave selector n selectors nselectors n selectors nselectors increment symbol frequencies selected table rfreq szptr recompute tables based accumulated frequencies n groups ngroups hb make code lengths hbmakecodelengths len rfreq alpha size alphasize rfreq fave cost n groups ngroups panic n selectors nselectors n selectors nselectors size panic compute mtf values selectors pos groups tmp tmp n groups ngroups pos n selectors nselectors selector tmp pos tmp tmp tmp tmp pos pos tmp pos tmp selector mtf selectormtf code groups max alpha size assign actual codes tables n groups ngroups min len minlen max len maxlen alpha size alphasize len max len maxlen max len maxlen len len min len minlen min len minlen len max len maxlen panic min len minlen panic hb assign codes hbassigncodes code len min len minlen max len maxlen alpha size alphasize transmit mapping table in use inuse in use inuse in use inuse in use inuse in use inuse bs w bsw bs w bsw in use inuse in use inuse bs w bsw bs w bsw selectors bs w bsw n groups ngroups bs w bsw n selectors nselectors n selectors nselectors selector mtf selectormtf bs w bsw bs w bsw n groups ngroups curr len bs w bsw curr alpha size alphasize curr len bs w bsw curr curr len bs w bsw curr bs w bsw block data proper sel ctr selctr n mtf nmtf size n mtf nmtf n mtf nmtf bs w bsw len selector sel ctr selctr szptr code selector sel ctr selctr szptr sel ctr selctr sel ctr selctr n selectors nselectors panic simple sort simplesort big n bign big n bign big n bign incs big n bign incs copy zptr full gt u fullgtu zptr zptr zptr zptr copy zptr full gt u fullgtu zptr zptr zptr zptr copy zptr full gt u fullgtu zptr zptr zptr zptr work done workdone work limit worklimit first attempt firstattempt vswap temp temp zptr zptr zptr zptr temp write run writerun ioexception allowable block size allowableblocksize in use inuse current char currentchar run length runlength crc update crc updatecrc current char currentchar run length runlength block current char currentchar block current char currentchar block current char currentchar block current char currentchar block current char currentchar block current char currentchar in use inuse run length runlength block current char currentchar block current char currentchar block current char currentchar block current char currentchar block run length runlength end block endblock init block initblock write run writerun stack elem stackelem