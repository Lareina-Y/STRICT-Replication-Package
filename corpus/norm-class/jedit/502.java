file bean shell beanshell java scripting distribution documentation updates http beanshell org sun license notice contents file subject sun license version license file compliance license copy license http sun original code bean shell beanshell initial developer original code pat niemeyer portions created pat niemeyer copyright rights reserved gnu license notice alternatively contents file terms gnu lesser general license lgpl provisions lgpl applicable version file terms lgpl version file spl decision deleting provisions replace notice provisions required lgpl delete provisions recipient version file spl lgpl patrick niemeyer pat pat net author learning java reilly associates http pat net pat org gjt jedit bsh org gjt jedit bsh org objectweb asm org gjt jedit bsh org objectweb asm type java lang reflect java util array list arraylist java util list notes hard eliminate org objectweb asm type making distribution tiny bit smaller suppress warnings suppresswarnings unchecked class generator util classgeneratorutil constants field holding reference bsh callback namespace methods string bshstatic bsh static bshstatic instance field holding reference bsh instance callback namespace instance methods string bshthis bsh this bshthis prefix delegate methods bsh superfoo bshsuperfoo equivalent foo string bshsuper bsh super bshsuper bsh namespace variable instance initializer string bshinit bsh instance initializer bshinstanceinitializer bsh namespace variable holds constructor methods string bshconstructors bsh constructors bshconstructors branch number constructor branch defaultconstructor string object ljava lang object string class name classname fully qualified foo bar blah string fq class name fqclassname super class superclass string super class name superclassname interfaces variable vars constructor super constructors superconstructors delayed eval bsh method delayedevalbshmethod constructors delayed eval bsh method delayedevalbshmethod methods name space namespace class static name space classstaticnamespace modifiers class modifiers classmodifiers is interface isinterface param package name packagename foo bar class generator util classgeneratorutil modifiers class modifiers classmodifiers string class name classname string package name packagename super class superclass interfaces variable vars delayed eval bsh method delayedevalbshmethod bshmethods name space namespace class static name space classstaticnamespace is interface isinterface class modifiers classmodifiers class modifiers classmodifiers class name classname class name classname package name packagename fq class name fqclassname package name packagename replace class name classname fq class name fqclassname class name classname super class superclass super class superclass object super class superclass super class superclass super class name superclassname type get internal name getinternalname super class superclass interfaces interfaces interfaces interfaces vars vars class static name space classstaticnamespace class static name space classstaticnamespace super constructors superconstructors super class superclass get declared constructors getdeclaredconstructors split methods constructors regular method lists list consl array list arraylist list methodsl array list arraylist classes string class base name classbasename get base name getbasename class name classname bshmethods length bshmethods get name getname equals class base name classbasename consl add bshmethods methodsl add bshmethods constructors delayed eval bsh method delayedevalbshmethod consl to array toarray delayed eval bsh method delayedevalbshmethod methods delayed eval bsh method delayedevalbshmethod methodsl to array toarray delayed eval bsh method delayedevalbshmethod class static name space classstaticnamespace set local variable setlocalvariable bshconstructors constructors strict util eval error utilevalerror interpreter error interpretererror set cons is interface isinterface is interface isinterface generate bytecode generate class generateclass force class mods classmods get asmmodifiers getasmmodifiers class modifiers classmodifiers acc is interface isinterface class mods classmods acc string interface names interfacenames string interfaces length interfaces length interface names interfacenames type get internal name getinternalname interfaces string source file sourcefile bean shell beanshell generated asm objectweb org class writer classwriter class writer classwriter visit class mods classmods fq class name fqclassname super class name superclassname interface names interfacenames source file sourcefile is interface isinterface generate bsh instance reference holder field generate field generatefield bshthis class name classname lorg gjt jedit bsh acc generate bsh reference holder field generate field generatefield bshstatic class name classname lorg gjt jedit bsh acc acc generate fields vars length string type vars get type descriptor gettypedescriptor note loose types parsed vars has modifier hasmodifier type modifiers is interface isinterface modifiers acc acc acc modifiers get asmmodifiers getasmmodifiers vars get modifiers getmodifiers generate field generatefield vars get name getname type modifiers generate constructors has constructor hasconstructor constructors length don generate constructors constructors has modifier hasmodifier modifiers get asmmodifiers getasmmodifiers constructors get modifiers getmodifiers generate constructor generateconstructor constructors get param type descriptors getparamtypedescriptors modifiers has constructor hasconstructor constructors generate constructor is interface isinterface has constructor hasconstructor generate constructor generateconstructor defaultconstructor string acc generate delegate methods methods length string return type returntype methods get return type descriptor getreturntypedescriptor don generate loosely typed methods methods has modifier hasmodifier return type returntype modifiers get asmmodifiers getasmmodifiers methods get modifiers getmodifiers is interface isinterface modifiers acc acc generate method generatemethod class name classname fq class name fqclassname methods get name getname return type returntype methods get param type descriptors getparamtypedescriptors modifiers is static isstatic modifiers acc overridden class contains method classcontainsmethod super class superclass methods get name getname methods get param type descriptors getparamtypedescriptors is static isstatic overridden generate super delegate method generatesuperdelegatemethod super class name superclassname methods get name getname return type returntype methods get param type descriptors getparamtypedescriptors modifiers to byte array tobytearray translate bsh modifiers asm modifier bitflags get asmmodifiers getasmmodifiers modifiers modifiers mods modifiers mods modifiers has modifier hasmodifier mods acc modifiers has modifier hasmodifier mods acc modifiers has modifier hasmodifier mods acc modifiers has modifier hasmodifier mods acc modifiers has modifier hasmodifier mods acc mods generate field instance generate field generatefield string field name fieldname string type modifiers class writer classwriter visit field visitfield modifiers field name fieldname type generate delegate method instance generated code packs method arguments object array wrapping primitive types bsh primitive invokes instance namespace invoke method invokemethod method unwraps returns result generate method generatemethod string class name classname string fq class name fqclassname string method name methodname string return type returntype string param types paramtypes modifiers class writer classwriter string exceptions is static isstatic modifiers acc map loose type object return type returntype return type returntype object string method descriptor methoddescriptor get method descriptor getmethoddescriptor return type returntype param types paramtypes generate method body code visitor codevisitor visit method visitmethod modifiers method name methodname method descriptor methoddescriptor exceptions modifiers acc generate code push bshthis bshstatic field is static isstatic visit field insn visitfieldinsn getstatic fq class name fqclassname bshstatic class name classname lorg gjt jedit bsh push visit var insn visitvarinsn aload instance field visit field insn visitfieldinsn getfield fq class name fqclassname bshthis class name classname lorg gjt jedit bsh push method constant visit ldc insn visitldcinsn method name methodname generate code push arguments object array generate parameter reifier code generateparameterreifiercode param types paramtypes is static isstatic push nulls args invoke method invokemethod interpreter visit insn visitinsn aconst callstack visit insn visitinsn aconst callerinfo visit insn visitinsn aconst push constant declared only declaredonly visit insn visitinsn iconst invoke method invoke method invokemethod sig visit method insn visitmethodinsn invokevirtual org gjt jedit bsh invoke method invokemethod type get method descriptor getmethoddescriptor type get type gettype object type type get type gettype string type get type gettype object type get type gettype interpreter type get type gettype call stack callstack type get type gettype simple node simplenode type get type gettype type generate code unwrap bsh primitive types visit method insn visitmethodinsn invokestatic org gjt jedit bsh primitive unwrap ljava lang object ljava lang object generate code generate return code generatereturncode return type returntype calculate fudging visit maxs visitmaxs generate constructor generate constructor generateconstructor string param types paramtypes modifiers class writer classwriter offset params args object args var argsvar param types paramtypes length offset params constructor args constructorargs cons args var consargsvar param types paramtypes length string exceptions string method descriptor methoddescriptor get method descriptor getmethoddescriptor param types paramtypes create constructor method code visitor codevisitor visit method visitmethod modifiers init method descriptor methoddescriptor exceptions generate code push arguments object array generate parameter reifier code generateparameterreifiercode param types paramtypes is static isstatic visit var insn visitvarinsn astore args var argsvar generate code implementing alternate constructor generate constructor switch generateconstructorswitch args var argsvar cons args var consargsvar generate code invoke class generator util classgeneratorutil init instance initinstance method push visit var insn visitvarinsn aload push constructor constant visit ldc insn visitldcinsn class name classname push arguments object array visit var insn visitvarinsn aload args var argsvar invoke init instance initinstance method visit method insn visitmethodinsn invokestatic org gjt jedit bsh class generator util classgeneratorutil init instance initinstance ljava lang object ljava lang string ljava lang object visit insn visitinsn calculate fudging visit maxs visitmaxs generate branch alternate constructor includes superclass constructors constructors branch superclass constructor method generates code call class generator util classgeneratorutil get constructor args getconstructorargs method inspects scripted constructor find alternate constructor signature evalute arguments runtime get constructor args getconstructorargs method returns actual arguments constructor call generate constructor switch generateconstructorswitch cons index consindex args var argsvar cons args var consargsvar code visitor codevisitor label default label defaultlabel label label end label endlabel label cases super constructors superconstructors length constructors length label labels label cases cases labels label generate code call class generator util classgeneratorutil args push super class name superclassname visit ldc insn visitldcinsn super class superclass get name getname push object visit field insn visitfieldinsn getstatic fq class name fqclassname bshstatic class name classname lorg gjt jedit bsh push args visit var insn visitvarinsn aload args var argsvar push constructor number stack visit int insn visitintinsn bipush cons index consindex invoke class generator util classgeneratorutil get constructors args getconstructorsargs method visit method insn visitmethodinsn invokestatic org gjt jedit bsh class generator util classgeneratorutil get constructor args getconstructorargs ljava lang string lorg gjt jedit bsh ljava lang object lorg gjt jedit bsh class generator util classgeneratorutil constructor args constructorargs store constructor args constructorargs cons args var consargsvar visit var insn visitvarinsn astore cons args var consargsvar constructor args constructorargs selector field constructor args constructorargs push constructor args constructorargs visit var insn visitvarinsn aload cons args var consargsvar visit field insn visitfieldinsn getfield org gjt jedit bsh class generator util classgeneratorutil constructor args constructorargs selector start visit table switch insn visittableswitchinsn min max cases default label defaultlabel labels generate body super constructors superconstructors length do switch branch doswitchbranch super class name superclassname get type descriptors gettypedescriptors super constructors superconstructors get parameter types getparametertypes end label endlabel labels cons args var consargsvar constructors length do switch branch doswitchbranch fq class name fqclassname constructors get param type descriptors getparamtypedescriptors end label endlabel labels cons args var consargsvar generate branch visit label visitlabel default label defaultlabel branch invokes args push visit var insn visitvarinsn aload visit method insn visitmethodinsn invokespecial super class name superclassname init visit label visitlabel end label endlabel generate branch constructor method called generate constructor switch generateconstructorswitch code generated method assumes argument array stack do switch branch doswitchbranch string target class name targetclassname string param types paramtypes label end label endlabel label labels cons args var consargsvar code visitor codevisitor visit label visitlabel labels visit line number visitlinenumber labels push args visit var insn visitvarinsn aload unload arguments constructor args constructorargs object param types paramtypes length string type param types paramtypes string method type equals method get boolean getboolean type equals method get byte getbyte type equals method get char getchar type equals method get short getshort type equals method get int getint type equals method get long getlong type equals method get double getdouble type equals method get float getfloat method get object getobject invoke iterator method constructor args constructorargs push constructor args constructorargs visit var insn visitvarinsn aload cons args var consargsvar string class name classname org gjt jedit bsh class generator util classgeneratorutil constructor args constructorargs string ret type rettype method equals get object getobject ret type rettype object ret type rettype type visit method insn visitmethodinsn invokevirtual class name classname method ret type rettype object type check method equals get object getobject visit type insn visittypeinsn checkcast descriptor to class name descriptortoclassname type invoke constructor branch string descriptor get method descriptor getmethoddescriptor param types paramtypes visit method insn visitmethodinsn invokespecial target class name targetclassname init descriptor visit jump insn visitjumpinsn end label endlabel string get method descriptor getmethoddescriptor string return type returntype string param types paramtypes string builder stringbuilder string builder stringbuilder param types paramtypes length append param types paramtypes append return type returntype to string tostring generate superclass method delegate accessor method methods specially named methods access overridden methods superclass java reflection api combine generate method generatemethod generate super delegate method generatesuperdelegatemethod string super class name superclassname string method name methodname string return type returntype string param types paramtypes modifiers class writer classwriter string exceptions map loose object return type returntype return type returntype object string method descriptor methoddescriptor get method descriptor getmethoddescriptor return type returntype param types paramtypes add method body code visitor codevisitor visit method visitmethod modifiers bsh super bshsuper method name methodname method descriptor methoddescriptor exceptions visit var insn visitvarinsn aload push vars local var index localvarindex param types paramtypes length is primitive isprimitive param types paramtypes visit var insn visitvarinsn iload local var index localvarindex visit var insn visitvarinsn aload local var index localvarindex local var index localvarindex param types paramtypes equals param types paramtypes equals visit method insn visitmethodinsn invokespecial super class name superclassname method name methodname method descriptor methoddescriptor generate plain return code generateplainreturncode return type returntype calculate fudging visit maxs visitmaxs class contains method classcontainsmethod clas string method name methodname string param types paramtypes clas method methods clas get declared methods getdeclaredmethods methods length methods get name getname equals method name methodname string method param types methodparamtypes get type descriptors gettypedescriptors methods get parameter types getparametertypes method param types methodparamtypes length param types paramtypes equals method param types methodparamtypes clas clas get superclass getsuperclass generate code normal bytecode generate plain return code generateplainreturncode string return type returntype code visitor codevisitor return type returntype equals visit insn visitinsn is primitive isprimitive return type returntype opcode ireturn return type returntype equals opcode dreturn return type returntype equals opcode freturn return type returntype equals opcode lreturn visit insn visitinsn opcode visit type insn visittypeinsn checkcast descriptor to class name descriptortoclassname return type returntype visit insn visitinsn areturn generates code reify arguments method method string code bytecode object bsh primitive expression author eric bruneton author pat niemeyer param code visitor generate bytecode param is static isstatic enclosing methods generate parameter reifier code generateparameterreifiercode string param types paramtypes is static isstatic code visitor codevisitor visit int insn visitintinsn sipush param types paramtypes length visit type insn visittypeinsn anewarray java lang object local var index localvarindex is static isstatic param types paramtypes length string param param types paramtypes visit insn visitinsn dup visit int insn visitintinsn sipush is primitive isprimitive param opcode param equals opcode fload param equals opcode dload param equals opcode lload opcode iload string type org gjt jedit bsh primitive visit type insn visittypeinsn type visit insn visitinsn dup visit var insn visitvarinsn opcode local var index localvarindex string desc param visit method insn visitmethodinsn invokespecial type init desc technically incorrect wrap values bsh primitive invoke method invokemethod generate conditional test primitive visit var insn visitvarinsn aload local var index localvarindex visit insn visitinsn aastore local var index localvarindex param equals param equals generates code unreify result method method string code bytecode integer int value intvalue expression param code visitor generate bytecode author eric bruneton author pat niemeyer generate return code generatereturncode string return type returntype code visitor codevisitor return type returntype equals visit insn visitinsn pop visit insn visitinsn is primitive isprimitive return type returntype opcode ireturn string type string meth return type returntype equals type java lang meth byte value bytevalue return type returntype equals type java lang integer meth int value intvalue return type returntype equals type java lang meth boolean value booleanvalue return type returntype equals opcode dreturn type java lang meth double value doublevalue return type returntype equals opcode freturn type java lang meth float value floatvalue return type returntype equals opcode lreturn type java lang meth long value longvalue return type returntype equals type java lang character meth char value charvalue return type returntype equals type java lang meth short value shortvalue string desc return type returntype type correct visit type insn visittypeinsn checkcast type visit method insn visitmethodinsn invokevirtual type meth desc visit insn visitinsn opcode visit type insn visittypeinsn checkcast descriptor to class name descriptortoclassname return type returntype visit insn visitinsn areturn evaluate arguments constructor constructor constructor args constructorargs object actual arguments alternate constructor constructor constructor param cons args consargs arguments constructor evaluation alt constructor args foo constructor args constructorargs object constructor selector evaluated arguments alternate constructor constructor args constructorargs get constructor args getconstructorargs string super class name superclassname class static this classstaticthis object cons args consargs delayed eval bsh method delayedevalbshmethod constructors constructors delayed eval bsh method delayedevalbshmethod class static this classstaticthis get name space getnamespace get variable getvariable bshconstructors exception interpreter error interpretererror unable instance initializer auto gen constructor defaultconstructor constructor constructor args constructorargs delayed eval bsh method delayedevalbshmethod constructor constructors constructor method body methodbody jjt get num children jjtgetnumchildren constructor constructor args constructorargs determine constructor calls string alt constructor altconstructor bsharguments args node argsnode simple node simplenode first statement firststatement simple node simplenode constructor method body methodbody jjt get child jjtgetchild first statement firststatement bshprimary expression bshprimaryexpression first statement firststatement simple node simplenode first statement firststatement jjt get child jjtgetchild first statement firststatement bshmethod invocation bshmethodinvocation bshmethod invocation bshmethodinvocation method node methodnode bshmethod invocation bshmethodinvocation first statement firststatement bshambiguous name bshambiguousname method name methodname method node methodnode get name node getnamenode method name methodname text equals method name methodname text equals alt constructor altconstructor method name methodname text args node argsnode method node methodnode get args node getargsnode alt constructor altconstructor constructor constructor args constructorargs tmp namespace hold original constructor args eval parameters node name space namespace cons args name space consargsnamespace name space namespace class static this classstaticthis get name space getnamespace cons args consargs string cons arg names consargnames constructor get parameter names getparameternames cons arg types consargtypes constructor get parameter types getparametertypes cons args consargs length cons args name space consargsnamespace set typed variable settypedvariable cons arg names consargnames cons arg types consargtypes cons args consargs modifiers util eval error utilevalerror interpreter error interpretererror err setting local cons arg evaluate args call stack callstack callstack call stack callstack callstack push cons args name space consargsnamespace object args interpreter interpreter class static this classstaticthis declaring interpreter declaringinterpreter args args node argsnode get arguments getarguments callstack interpreter eval error evalerror interpreter error interpretererror error evaluating constructor args arg types argtypes types get types gettypes args args primitive unwrap args super class superclass interpreter get class manager getclassmanager class for name classforname super class name superclassname super class superclass interpreter error interpretererror find superclass super class name superclassname constructor super cons supercons super class superclass get declared constructors getdeclaredconstructors find matching constructor args alt constructor altconstructor equals reflect find most specific constructor index findmostspecificconstructorindex arg types argtypes super cons supercons interpreter error interpretererror find constructor args constructor args constructorargs args find matching constructor args candidates constructors length candidates length candidates constructors get parameter types getparametertypes reflect find most specific signature findmostspecificsignature arg types argtypes candidates interpreter error interpretererror find constructor args constructors constructors table selector super cons supercons length our selector ourselector super cons supercons length choosing recursively reference selector our selector ourselector interpreter error interpretererror recusive constructor call constructor args constructorargs selector args initialize instance method called generated constructor evaluate instance initializer scripted constructor instance namespace init instance initinstance object instance string class name classname object args sig types get types gettypes args call stack callstack callstack call stack callstack interpreter interpreter name space namespace instance name space instancenamespace check instance initialized alternate constuctor instance this instancethis get class instance this getclassinstancethis instance class name classname xxx clean conditional instance this instancethis create instance namespace set object instance invoke instance initializer reference proto instance class static this classstaticthis get class static this getclassstaticthis instance get class getclass class name classname interpreter class static this classstaticthis declaring interpreter declaringinterpreter instance initializer block bshblock instance init block instanceinitblock instance init block instanceinitblock bshblock class static this classstaticthis get name space getnamespace get variable getvariable bshinit exception interpreter error interpretererror unable instance initializer create instance namespace instance name space instancenamespace name space namespace class static this classstaticthis get name space getnamespace class name classname instance name space instancenamespace is class isclass set instance reference instance instance this instancethis instance name space instancenamespace get this getthis interpreter lhs lhs reflect get lhsobject field getlhsobjectfield instance bshthis class name classname lhs assign instance this instancethis strict exception interpreter error interpretererror error gen setup instance space object instance name space instancenamespace set class instance setclassinstance instance pop callstack push instance name space instancenamespace evaluate initializer block instance init block instanceinitblock eval block evalblock callstack override interpreter class generator impl classgeneratorimpl class node filter classnodefilter classinstance exception interpreter error interpretererror error initialization callstack pop object instance initialzed constructor fall invoke constructor body interpreter instance this instancethis declaring interpreter declaringinterpreter instance name space instancenamespace instance this instancethis get name space getnamespace invoke constructor method instance this instancethis string constructor name constructorname get base name getbasename class name classname find constructor instance namespace bsh method bshmethod constructor instance name space instancenamespace get method getmethod constructor name constructorname declared only declaredonly sig args constructor args length constructor interpreter error interpretererror find constructor class name classname evaluate constructor constructor constructor invoke args interpreter callstack caller info callerinfo override name space overridenamespace exception target error targeterror exception target error targeterror get target gettarget invocation target exception invocationtargetexception exception invocation target exception invocationtargetexception get target exception gettargetexception print stack trace printstacktrace system err interpreter error interpretererror error initialization bsh namespace field param class name classname clas superclass clas get class static this getclassstaticthis clas string class name classname reflect get static field value getstaticfieldvalue clas bshstatic class name classname exception interpreter error interpretererror unable space instance bsh namespace field object instance instance object object initialized get class instance this getclassinstancethis object instance string class name classname object reflect get object field value getobjectfieldvalue instance bshthis class name classname unwrap primitive primitive unwrap exception interpreter error interpretererror generated error type descriptor string describe primitive type is primitive isprimitive string type descriptor typedescriptor type descriptor typedescriptor length string get type descriptors gettypedescriptors cparams string string cparams length length bshtype get type descriptor gettypedescriptor cparams array object type remove prefix suffix factored adding string descriptor to class name descriptortoclassname string starts with startswith starts with startswith substring length string get base name getbasename string class name classname class name classname index of indexof class name classname class name classname substring constructor args constructorargs object holds evaluated arguments constructor call alternate selector invoke object constructor generate constructor generateconstructor string class writer classwriter constructor args constructorargs constructor args constructorargs calls constructor constructor args constructorargs constructor args constructorargs selector defaultconstructor object args arg constructor args constructorargs constructor args constructorargs selector object args selector selector args args object args arg get boolean getboolean boolean value booleanvalue get byte getbyte byte value bytevalue get char getchar character char value charvalue get short getshort short value shortvalue get int getint integer int value intvalue get long getlong long value longvalue get double getdouble double value doublevalue get float getfloat float value floatvalue object get object getobject