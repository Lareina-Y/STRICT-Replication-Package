9150 – No check in FileAppender if parent-path exists
When using the PropertyConfigurator containing a link to a FileAppender and the
path to the requested log-file does not exist you get internal LOG4J-errors but
no log-file.
From my point of view there's a bug in the method 'setFile(String file)' in the
class 'FileAppender.java'.
I tried to solve the problem and find following solution (only with a few
tests):
...
public void setFile(String file)
{
// Trim spaces from both ends.
The users probably does not want
// trailing spaces in file names.
String val = file.trim();
fileName = val;
File tempFile = new File(fileName);
if (!(fileName.equals("")) && (tempFile.getParentFile() != null) &&
(tempFile.getParentFile().mkdirs()))
{
LogLog.debug("Create necessary directories '"+tempFile.getParentFile()+"'
for log-file '"+tempFile.getName()+"'");
}
if ((!(fileName.equals(""))) && ((tempFile.canWrite() || !(tempFile.exists
()))))
{
LogLog.debug("Set filename for FileAppender '"+fileName+"'");
}
else
{
LogLog.debug("Can't set filename for FileAppender to '"+fileName+"';
possible no write-access or undefined path");
fileName = null;
}
}
...