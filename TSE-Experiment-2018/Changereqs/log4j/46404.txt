46404 – NPE when logging an AxisFault with SocketAppender
Logging an org.apache.axis.AxisFault using the SimpleSocketServer results in a NullPointerException on the client side.
Versions:
Log4J 1.2.15
Java 1.4.2_10
axis 1.4
Test method:
public static void main(String[] args) throws Exception {
logger = Logger.getLogger(Test.class);
logger.debug("start");
logger.debug("err", new org.apache.axis.AxisFault());
}
Output on Client (in System.err):
log4j:WARN Detected problem with connection: java.io.IOException: stream active
java.lang.NullPointerException
at org.apache.log4j.net.SocketAppender.append(SocketAppender.java:243)
at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)
at org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)
at org.apache.log4j.Category.callAppenders(Category.java:206)
at org.apache.log4j.Category.forcedLog(Category.java:391)
at org.apache.log4j.Category.debug(Category.java:279)
at Test.main(SAPEquipmentQueryClientTest.java:421)
Exception in thread "main"
Output on Server's log:
2008-12-16 10:05:53,512 [main] INFO  net.SimpleSocketServer - Connected to client at /xxx.xxx.xxx.xxx
2008-12-16 10:05:53,514 [main] INFO  net.SimpleSocketServer - Starting new socket node.
2008-12-16 10:05:53,518 [main] INFO  net.SimpleSocketServer - Waiting to accept a new client.
2008-12-16 10:05:51,496 [main] DEBUG Test - start
2008-12-16 10:05:53,916 [Thread-98] INFO  net.SocketNode - Caught java.io.IOException: java.io.StreamCorruptedException
2008-12-16 10:05:53,917 [Thread-98] INFO  net.SocketNode - Closing connection.
Configuration Client:
log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/">
<appender name="SimpleServerSocketLogger" class="org.apache.log4j.net.SocketAppender">
<param name="remoteHost" value="host"/>
<param name="port" value="4445"/>
<param name="LocationInfo" value="true"/>
</appender>
<root>
<priority value="debug"/>
<appender-ref ref="SimpleServerSocketLogger"/>
</root>
</log4j:configuration>
Configuration Server:
<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/">
<appender name="Konsole" class="org.apache.log4j.DailyRollingFileAppender">
<param name="File" value="Java.log"/>
<param name="DatePattern" value="'.'yyyy-MM-dd"/>
<layout class="org.apache.log4j.PatternLayout">
<param name="ConversionPattern" value="%d [%t] %-5p %C{2} - %m%n"/>
</layout>
</appender>
<root>
<priority value="debug"/>
<appender-ref ref="Konsole"/>
</root>
</log4j:configuration>